"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[5498],{5498:(w,p,c)=>{c.r(p),c.d(p,{BalanceServicePageModule:()=>q});var n=c(9808),m=c(3075),s=c(8058),f=c(1059),h=c(8995),o=c(1216),v=c(7582),e=c(5e3),_=c(4726),b=c(5539),Z=c(5383),x=c(5988);function S(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"div",24),e.NdJ("click",function(){const l=e.CHM(t).$implicit,d=e.oxw(2);return e.KtG(d.selectPrice(l))}),e.TgZ(1,"div",25)(2,"p",26),e._uU(3),e.qZA(),e.TgZ(4,"p",27),e._uU(5),e.ALo(6,"numberFormat"),e.qZA()()()}if(2&i){const t=r.$implicit;e.ekj("active",t.selected),e.xp6(3),e.Oqu(t.name),e.xp6(2),e.Oqu(0==t.price_uzs?"\u0411\u0435\u0441\u043f\u043b\u0430\u0442\u043d\u043e(\u043e\u0444\u043e\u0440\u043c\u043b\u0435\u043d\u0438\u0435 \u0432 \u0422\u0438\u0440\u0433\u043e)":e.lcZ(6,4,t.price_uzs))}}function y(i,r){if(1&i&&(e.TgZ(0,"div",31)(1,"div",32)(2,"span"),e._uU(3,"ID \u0437\u0430\u043a\u0430\u0437\u0430:"),e.qZA(),e.TgZ(4,"span"),e._uU(5),e.qZA()(),e.TgZ(6,"div",32)(7,"span"),e._uU(8,"ID \u0443\u0441\u043b\u0443\u0433\u0438:"),e.qZA(),e.TgZ(9,"span"),e._uU(10),e.qZA()(),e.TgZ(11,"div",32)(12,"span"),e._uU(13,"\u0422\u0438\u043f:"),e.qZA(),e.TgZ(14,"span"),e._uU(15),e.qZA()(),e.TgZ(16,"div",32)(17,"span"),e._uU(18,"\u0421\u0443\u043c\u043c\u0430:"),e.qZA(),e.TgZ(19,"span"),e._uU(20),e.qZA()(),e.TgZ(21,"div",32)(22,"span"),e._uU(23,"\u0414\u0430\u0442\u0430:"),e.qZA(),e.TgZ(24,"span"),e._uU(25),e.ALo(26,"date"),e.qZA()()()),2&i){const t=r.$implicit;e.xp6(5),e.Oqu(t.id),e.xp6(5),e.Oqu(t.service_id),e.xp6(5),e.Oqu(t.name),e.xp6(5),e.Oqu(t.price_uzs),e.xp6(5),e.hij("",e.xi3(26,5,t.createAt,"dd.MM.YYYY")," ")}}function A(i,r){if(1&i&&(e.TgZ(0,"div",28)(1,"p",18),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.TgZ(4,"div",29),e.YNc(5,y,27,8,"div",30),e.qZA()()),2&i){const t=e.oxw(2);e.xp6(2),e.Oqu(e.lcZ(3,2,"\u0418\u0441\u0442\u043e\u0440\u0438\u044f \u043e\u0444\u043e\u0440\u043c\u043b\u0435\u043d\u0438\u0439 \u0443\u0441\u043b\u0443\u0433")),e.xp6(3),e.Q6J("ngForOf",t.history)}}const g=function(i){return{selected:i}};function B(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"div",8)(1,"div",9),e._UZ(2,"img",10),e.TgZ(3,"p",11),e._uU(4),e._UZ(5,"span"),e.qZA()(),e.TgZ(6,"p",4)(7,"b"),e._uU(8),e.ALo(9,"translate"),e.qZA()(),e.TgZ(10,"div",12)(11,"div",13)(12,"button",14),e.NdJ("click",function(){e.CHM(t);const u=e.oxw();return e.KtG(u.selectmethodpay="click")}),e._UZ(13,"img",15),e.qZA(),e.TgZ(14,"button",14),e.NdJ("click",function(){e.CHM(t);const u=e.oxw();return e.KtG(u.selectmethodpay="payme")}),e._UZ(15,"img",16),e.qZA()()(),e.TgZ(16,"div",17)(17,"p",18),e._uU(18),e.ALo(19,"translate"),e.qZA(),e.TgZ(20,"div",19),e.YNc(21,S,7,6,"div",20),e.qZA(),e.TgZ(22,"div",21)(23,"button",22),e.NdJ("click",function(){e.CHM(t);const u=e.oxw();return e.KtG(u.pay())}),e._uU(24),e.ALo(25,"translate"),e.qZA()()(),e.YNc(26,A,6,4,"div",23),e.qZA()}if(2&i){const t=e.oxw();e.xp6(4),e.hij("\u0411\u0430\u043b\u0430\u043d\u0441: ",t.alpha_balance," "),e.xp6(4),e.Oqu(e.lcZ(9,9,"\u041c\u0435\u0442\u043e\u0434\u044b \u043e\u043f\u043b\u0430\u0442\u044b")),e.xp6(4),e.Q6J("ngClass",e.VKq(15,g,"click"===t.selectmethodpay)),e.xp6(2),e.Q6J("ngClass",e.VKq(17,g,"payme"===t.selectmethodpay)),e.xp6(4),e.Oqu(e.lcZ(19,11,"\u0423\u0441\u043b\u0443\u0433\u0438")),e.xp6(3),e.Q6J("ngForOf",t.services),e.xp6(2),e.Q6J("disabled",0==(null==t.selectedServices?null:t.selectedServices.length)||t.loading),e.xp6(1),e.Oqu(e.lcZ(25,13,"\u041f\u043e\u0434\u043a\u043b\u044e\u0447\u0438\u0442\u044c")),e.xp6(2),e.Q6J("ngIf",(null==t.history?null:t.history.length)>0)}}function U(i,r){1&i&&(e.TgZ(0,"ion-card")(1,"ion-card-header")(2,"ion-card-title",33),e._uU(3,"\u0412\u0430\u0448\u0430 \u0437\u0430\u044f\u0432\u043a\u0430 \u043f\u0440\u0438\u043d\u044f\u0442\u0430 \u043d\u0430 \u043e\u0431\u0440\u0430\u0431\u043e\u0442\u043a\u0443"),e.qZA()(),e.TgZ(4,"ion-button",34),e._uU(5,"OK"),e.qZA()())}const T=[{path:"",component:(()=>{class i{constructor(t,a,u,l,d,C){this.iab=t,this.navCtrl=a,this.authService=u,this.socketService=l,this.route=d,this.router=C,this.loading=!1,this.selectmethodpay="click",this.amount="",this.payConfirm=!1,this.selectedServices=[],this.amount_sum=0,this.formattedData=[],this.alpha_balance=0}ngOnInit(){this.updateDriverBalance(),this.getPrice(),this.route.queryParamMap.subscribe(t=>{t&&(this.subscriptionId=t.get("subscription_id"))}),this.getHistory()}getHistory(){this.authService.serviceHistory(this.authService.currentUser.id).subscribe(t=>{t.status&&(this.history=t.data)})}getAlphaBalance(){this.authService.getAlhpaBalance(this.authService.currentUser.id).subscribe(t=>{t.status&&(this.alpha_balance=t.total_balance)})}getPrice(){this.authService.getServicesList().subscribe(t=>{t.status&&(this.services=t.data)})}selectPrice(t){t.selected=!t.selected,this.selectedServices=this.services.filter(a=>a.selected)}back(){this.navCtrl.back()}pay(){return(0,v.mG)(this,void 0,void 0,function*(){if(this.authService.currentUser.issubscription)if(this.amount_sum=this.selectedServices.reduce((t,a)=>t+Number(a.price_uzs),0),this.amount_sum>this.alpha_balance){if(this.loading=!1,"click"===this.selectmethodpay)this.iab.create("https://my.click.uz/services/pay?service_id=32406&merchant_id=24561&amount="+(this.amount_sum-+this.alpha_balance)+"&transaction_param="+this.authService.currentUser.id,"_system"),this.amount_sum=0;else if("payme"===this.selectmethodpay){let t=btoa("m=65dc59df3c319dec9d8c3953;ac.UserID="+this.authService.currentUser.id+";a="+(+this.amount_sum-+this.alpha_balance)+"00");this.iab.create("https://checkout.paycom.uz/"+t,"_system"),this.amount_sum=0}}else this.formattedData=[],this.selectedServices.forEach(a=>{this.formattedData.push({services_id:a.id,price_uzs:a.price_uzs,price_kzs:a.price_kzs,rate:a.rate})}),this.authService.freeService({phone:this.authService.currentUser.phone,user_id:this.authService.currentUser.id,services:this.formattedData}).subscribe(a=>{a.status&&(this.loading=!1,this.authService.alert("\u041f\u043e\u0434\u043f\u0438\u0441\u043a\u0430 \u0443\u0441\u043f\u0435\u0448\u043d\u043e \u043e\u0444\u043e\u0440\u043c\u043b\u0435\u043d\u0430 !",""),this.router.navigate(["/tabs/home"]))},a=>{this.loading=!1,this.authService.alert("\u041e\u0448\u0438\u0431\u043a\u0430",a.error.error)});else this.loading=!1,this.authService.alert("\u041e\u0444\u043e\u0440\u043c\u0438\u0442\u0435 \u043f\u043e\u0434\u043f\u0438\u0441\u043a\u0443 \u0447\u0442\u043e\u0431\u044b \u0432\u043e\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c\u0441\u044f \u0443\u0441\u043b\u0443\u0433\u0430\u043c\u0438 \u0422\u0438\u0440\u0433\u043e",""),this.router.navigate(["/addsubscribe"])})}withdrawFromActivebalance(){return(0,v.mG)(this,void 0,void 0,function*(){this.authService.currentUser.balance>0?this.authService.withdrawBalance(this.authService.currentUser.id).subscribe(t=>{t.status?this.payConfirm=!0:t.status||"No enough balance"!=t.error?!t.status&&"No enough balance"==t.error&&this.authService.alert("\u041e\u0448\u0438\u0431\u043a\u0430",t.error.toString()):this.authService.alert("\u041e\u0448\u0438\u0431\u043a\u0430","\u0423 \u0432\u0430\u0441 \u043d\u0435\u0442 \u0430\u043a\u0442\u0438\u0432\u043d\u043e\u0433\u043e \u0431\u0430\u043b\u0430\u043d\u0441\u0430")}):yield this.authService.alert("\u041e\u0448\u0438\u0431\u043a\u0430","\u0423 \u0432\u0430\u0441 \u043d\u0435\u0442 \u0430\u043a\u0442\u0438\u0432\u043d\u043e\u0433\u043e \u0431\u0430\u043b\u0430\u043d\u0441\u0430")})}updateDriverBalance(){this.socketService.updateDriverBalance().subscribe(t=>{if(t){const a=JSON.parse(t);this.authService.currentUser.balance=a.balance,this.authService.currentUser.balance_off=a.balance_off,this.authService.currentUser.balance_in_proccess=a.balance_in_proccess}})}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(_.i),e.Y36(s.SH),e.Y36(b.$),e.Y36(Z.$),e.Y36(o.gz),e.Y36(o.F0))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-balance"]],decls:13,vars:5,consts:[[1,"wrapper-fluid-header"],[1,"logo-wrap","personal-head"],[1,"top-back",3,"click"],["src","assets/img/arrow-left.svg","alt",""],[1,"ion-no-padding","ion-no-margin"],[1,"wrapper-fluid"],["class","body-wrap",4,"ngIf"],[4,"ngIf"],[1,"body-wrap"],[1,"cart-wrap"],["src","assets/img/logo.png","alt",""],[1,"cart-wrap-balance"],[1,"payment-method"],[1,"payment-method-wrap"],[3,"ngClass","click"],["src","assets/payment/click.svg","alt",""],["src","assets/payment/payme.svg","alt",""],[2,"width","100%"],[2,"text-align","center","width","100%"],[1,"body-wrap","form-block",2,"width","100%"],["class","price-card",3,"active","click",4,"ngFor","ngForOf"],[1,"payment-total","form-block"],[1,"reg-btn","podpis-buy",2,"background-color","rgba(255, 113, 0, 1)",3,"disabled","click"],["style","width: 100%; margin-top: 20px;",4,"ngIf"],[1,"price-card",3,"click"],[2,"display","flex","justify-content","space-between","width","100%"],[1,"month-text"],[1,"price-text"],[2,"width","100%","margin-top","20px"],[1,"",2,"width","100%","overflow-y","auto","max-height","300px","padding","50px 0"],["class","price-card","style","display: block !important;margin: 5px 0;",4,"ngFor","ngForOf"],[1,"price-card",2,"display","block !important","margin","5px 0"],[2,"width","100%","color","white","display","flex","gap","10px"],[2,"text-align","center"],["routerLink","/tabs",2,"display","flex"]],template:function(t,a){1&t&&(e.TgZ(0,"ion-header")(1,"div",0)(2,"div",1)(3,"button",2),e.NdJ("click",function(){return a.back()}),e._UZ(4,"img",3),e.qZA(),e.TgZ(5,"h2"),e._uU(6),e.ALo(7,"translate"),e.qZA(),e._UZ(8,"div"),e.qZA()()(),e.TgZ(9,"ion-content",4)(10,"div",5),e.YNc(11,B,27,19,"div",6),e.qZA()(),e.YNc(12,U,6,0,"ion-card",7)),2&t&&(e.xp6(6),e.Oqu(e.lcZ(7,3,"\u0411\u0430\u043b\u0430\u043d\u0441 Tirgo Service")),e.xp6(5),e.Q6J("ngIf",a.authService.currentUser),e.xp6(1),e.Q6J("ngIf",a.payConfirm))},dependencies:[n.mk,n.sg,n.O5,s.YG,s.PM,s.Zi,s.Dq,s.W2,s.Gu,s.YI,o.rH,n.uU,h.X$,x.p],styles:[".price-card[_ngcontent-%COMP%]{display:flex;align-items:center;border:2px solid #ccc;border-radius:10px;padding:10px;width:100%;gap:20px;margin:5px 0}.radio[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;height:30px;width:30px;background-color:#ccc;border-radius:50%}.radio[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{width:15px;height:15px;border-radius:50%;background-color:#ff7100}.price-card.active[_ngcontent-%COMP%]{border:3px solid rgb(255,113,0)}"]}),i})()}];let P=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[o.Bz.forChild(T),o.Bz]}),i})();var k=c(1456);let q=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[n.ez,m.u5,s.Pc,P,f.HeaderPageModule,h.aw,k.h]}),i})()}}]);