"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[5498],{5498:(M,p,r)=>{r.r(p),r.d(p,{BalanceServicePageModule:()=>F});var n=r(9808),f=r(3075),s=r(8058),_=r(1059),h=r(8995),o=r(1216),g=r(7582),e=r(5e3),m=r(4726),b=r(5539),S=r(5383),Z=r(5988);function x(i,c){1&i&&(e.TgZ(0,"span"),e._uU(1,"\u0441\u0443\u043c"),e.qZA())}function B(i,c){if(1&i){const t=e.EpF();e.TgZ(0,"div",27),e.NdJ("click",function(){const l=e.CHM(t).$implicit,d=e.oxw(2);return e.KtG(d.selectPrice(l))}),e.TgZ(1,"div")(2,"p",28),e._uU(3),e.qZA(),e.TgZ(4,"p",29),e._uU(5),e.ALo(6,"numberFormat"),e.YNc(7,x,2,0,"span",9),e.qZA()()()}if(2&i){const t=c.$implicit;e.ekj("active",t.selected),e.xp6(3),e.hij("",t.name,":"),e.xp6(2),e.hij("\u0426\u0435\u043d\u0430: ",0==t.price_uzs?"\u0411\u0435\u0441\u043f\u043b\u0430\u0442\u043d\u043e (\u043e\u0444\u043e\u0440\u043c\u043b\u0435\u043d\u0438\u0435 \u0432 \u0422\u0438\u0440\u0433\u043e)":e.lcZ(6,5,t.price_uzs)," "),e.xp6(2),e.Q6J("ngIf",0!=t.price_uzs)}}function y(i,c){if(1&i){const t=e.EpF();e.TgZ(0,"button",30),e.NdJ("click",function(){e.CHM(t);const u=e.oxw(2);return e.KtG(u.goToSupportAdmin())}),e._UZ(1,"img",31),e.TgZ(2,"span"),e._uU(3),e.ALo(4,"translate"),e.qZA()()}2&i&&(e.xp6(3),e.Oqu(e.lcZ(4,1,"\u0414\u043e\u043f\u043e\u043b\u043d\u0438\u0442\u0435\u043b\u044c\u043d\u044b\u0435 \u0443\u0441\u043b\u0443\u0433\u0438")))}function T(i,c){1&i&&(e.TgZ(0,"span"),e._uU(1,"\u0441\u0443\u043c"),e.qZA())}function A(i,c){if(1&i&&(e.TgZ(0,"div",35)(1,"div",36)(2,"span"),e._uU(3,"ID \u0437\u0430\u043a\u0430\u0437\u0430:"),e.qZA(),e.TgZ(4,"span"),e._uU(5),e.qZA()(),e.TgZ(6,"div",36)(7,"span"),e._uU(8,"ID \u0443\u0441\u043b\u0443\u0433\u0438:"),e.qZA(),e.TgZ(9,"span"),e._uU(10),e.qZA()(),e.TgZ(11,"div",36)(12,"span"),e._uU(13,"\u0422\u0438\u043f:"),e.qZA(),e.TgZ(14,"span"),e._uU(15),e.qZA()(),e.TgZ(16,"div",36)(17,"span"),e._uU(18,"\u0421\u0443\u043c\u043c\u0430:"),e.qZA(),e.TgZ(19,"span"),e._uU(20),e.ALo(21,"numberFormat"),e.YNc(22,T,2,0,"span",9),e.qZA()(),e.TgZ(23,"div",36)(24,"span"),e._uU(25,"\u0414\u0430\u0442\u0430:"),e.qZA(),e.TgZ(26,"span"),e._uU(27),e.ALo(28,"date"),e.qZA()()()),2&i){const t=c.$implicit;e.xp6(5),e.Oqu(t.id),e.xp6(5),e.Oqu(t.service_id),e.xp6(5),e.Oqu(t.name),e.xp6(5),e.hij("",0==t.price_uzs?"\u0411\u0435\u0441\u043f\u043b\u0430\u0442\u043d\u043e(\u043e\u0444\u043e\u0440\u043c\u043b\u0435\u043d\u0438\u0435 \u0432 \u0422\u0438\u0440\u0433\u043e)":e.lcZ(21,6,t.price_uzs)," "),e.xp6(2),e.Q6J("ngIf",0!=t.price_uzs),e.xp6(5),e.hij("",e.xi3(28,8,t.createAt,"dd.MM.YYYY")," ")}}function U(i,c){if(1&i&&(e.TgZ(0,"div",32)(1,"p",20),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.TgZ(4,"div",33),e.YNc(5,A,29,11,"div",34),e.qZA()()),2&i){const t=e.oxw(2);e.xp6(2),e.Oqu(e.lcZ(3,2,"\u0418\u0441\u0442\u043e\u0440\u0438\u044f \u043e\u0444\u043e\u0440\u043c\u043b\u0435\u043d\u0438\u0439 \u0443\u0441\u043b\u0443\u0433")),e.xp6(3),e.Q6J("ngForOf",t.history)}}const v=function(i){return{selected:i}};function P(i,c){if(1&i){const t=e.EpF();e.TgZ(0,"div",10)(1,"div",11),e._UZ(2,"img",12),e.TgZ(3,"p",13),e._uU(4),e._UZ(5,"span"),e.qZA()(),e.TgZ(6,"p",4)(7,"b"),e._uU(8),e.ALo(9,"translate"),e.qZA()(),e.TgZ(10,"div",14)(11,"div",15)(12,"button",16),e.NdJ("click",function(){e.CHM(t);const u=e.oxw();return e.KtG(u.selectmethodpay="click")}),e._UZ(13,"img",17),e.qZA(),e.TgZ(14,"button",16),e.NdJ("click",function(){e.CHM(t);const u=e.oxw();return e.KtG(u.selectmethodpay="payme")}),e._UZ(15,"img",18),e.qZA()()(),e.TgZ(16,"div",19)(17,"p",20),e._uU(18),e.ALo(19,"translate"),e.qZA(),e.TgZ(20,"div",21),e.YNc(21,B,8,7,"div",22),e.qZA(),e.TgZ(22,"div",23)(23,"button",24),e.NdJ("click",function(){e.CHM(t);const u=e.oxw();return e.KtG(u.pay())}),e._uU(24),e.ALo(25,"translate"),e.qZA()(),e.YNc(26,y,5,3,"button",25),e.qZA(),e.YNc(27,U,6,4,"div",26),e.qZA()}if(2&i){const t=e.oxw();e.xp6(4),e.hij("\u0411\u0430\u043b\u0430\u043d\u0441: ",t.alpha_balance," \u0441\u0443\u043c "),e.xp6(4),e.Oqu(e.lcZ(9,10,"\u041c\u0435\u0442\u043e\u0434 \u043e\u043f\u043b\u0430\u0442\u044b")),e.xp6(4),e.Q6J("ngClass",e.VKq(16,v,"click"===t.selectmethodpay)),e.xp6(2),e.Q6J("ngClass",e.VKq(18,v,"payme"===t.selectmethodpay)),e.xp6(4),e.Oqu(e.lcZ(19,12,"\u0423\u0441\u043b\u0443\u0433\u0438")),e.xp6(3),e.Q6J("ngForOf",t.services),e.xp6(2),e.Q6J("disabled",0==(null==t.selectedServices?null:t.selectedServices.length)||t.loading),e.xp6(1),e.Oqu(e.lcZ(25,14,"\u041e\u0444\u043e\u0440\u043c\u0438\u0442\u044c")),e.xp6(2),e.Q6J("ngIf",t.showTgButton),e.xp6(1),e.Q6J("ngIf",(null==t.history?null:t.history.length)>0)}}function k(i,c){1&i&&(e.TgZ(0,"ion-card")(1,"ion-card-header")(2,"ion-card-title",37),e._uU(3,"\u0412\u0430\u0448\u0430 \u0437\u0430\u044f\u0432\u043a\u0430 \u043f\u0440\u0438\u043d\u044f\u0442\u0430 \u043d\u0430 \u043e\u0431\u0440\u0430\u0431\u043e\u0442\u043a\u0443"),e.qZA()(),e.TgZ(4,"ion-button",38),e._uU(5,"OK"),e.qZA()())}const C=[{path:"",component:(()=>{class i{constructor(t,a,u,l,d,O,E){this.iab=t,this.navCtrl=a,this.authService=u,this.socketService=l,this.route=d,this.router=O,this.cdr=E,this.loading=!1,this.selectmethodpay="click",this.amount="",this.payConfirm=!1,this.selectedServices=[],this.amount_sum=0,this.formattedData=[],this.alpha_balance=0,this.showTgButton=!1}ngOnInit(){this.route.queryParamMap.subscribe(t=>{t&&(this.subscriptionId=t.get("subscription_id"))}),this.getHistory(),this.checkShowButton(),this.getAlphaBalance(),this.updateDriverBalance(),this.getPrice(),this.socketService.updateTirgoServiceBalance().subscribe(t=>{this.getAlphaBalance(),this.getPrice(),this.getHistory(),this.checkShowButton(),this.getAlphaBalance(),this.updateDriverBalance(),this.cdr.detectChanges()}),this.socketService.updateTirgoServices().subscribe(t=>{this.getPrice(),this.cdr.detectChanges()})}getHistory(){this.authService.serviceHistory(this.authService.currentUser.id).subscribe(t=>{t.status&&(this.history=Array.isArray(t.data)?t.data.slice(0,10):[])})}getAlphaBalance(){this.authService.getTirgoBalance(this.authService.currentUser).subscribe(t=>{t.status&&(this.alpha_balance=t.data.balance)})}getPrice(){this.authService.getServicesList().subscribe(t=>{t.status&&(this.services=t.data)})}selectPrice(t){t.selected=!t.selected,this.selectedServices=this.services.filter(a=>a.selected)}back(){this.router.navigate(["/tabs/home"]),this.services.forEach((t,a)=>{t.selected&&(t.selected=!1)})}pay(){return(0,g.mG)(this,void 0,void 0,function*(){this.authService.currentUser.issubscription?(this.amount_sum=this.selectedServices.reduce((t,a)=>t+Number(a.price_uzs),0),this.amount_sum>this.alpha_balance?(this.authService.alertAcceptPayment("\u041f\u043e\u043f\u043e\u043b\u043d\u0438\u0442\u0435 \u0441\u0432\u043e\u0439 \u0431\u0430\u043b\u0430\u043d\u0441 \u0447\u0442\u043e\u0431\u044b \u043e\u0444\u043e\u0440\u043c\u0438\u0442\u044c \u0443\u0441\u043b\u0443\u0433\u0443",this.selectmethodpay,this.amount_sum-+this.alpha_balance),this.loading=!1,this.amount_sum=0):(this.formattedData=[],this.selectedServices.forEach(a=>{this.formattedData.push({services_id:a.id,price_uzs:a.price_uzs,price_kzs:a.price_kzs,rate:a.rate})}),this.authService.freeService({phone:this.authService.currentUser.phone,user_id:this.authService.currentUser.id,services:this.formattedData}).subscribe(a=>{a.status&&(this.loading=!1,this.authService.alertPayAndRedirectTg())},a=>{(a.error.error="\u041d\u0435\u0434\u043e\u0441\u0442\u0430\u0442\u043e\u0447\u043d\u043e \u0441\u0440\u0435\u0434\u0441\u0442\u0432 \u043d\u0430 \u0431\u0430\u043b\u0430\u043d\u0441\u0435")||(this.loading=!1),this.authService.alert("\u041e\u0448\u0438\u0431\u043a\u0430",a.error.error)}))):(this.loading=!1,this.authService.alert("\u041e\u0444\u043e\u0440\u043c\u0438\u0442\u0435 \u043f\u043e\u0434\u043f\u0438\u0441\u043a\u0443 \u0447\u0442\u043e\u0431\u044b \u0432\u043e\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c\u0441\u044f \u0443\u0441\u043b\u0443\u0433\u0430\u043c\u0438 \u0422\u0438\u0440\u0433\u043e",""),this.router.navigate(["/addsubscribe"]))})}withdrawFromActivebalance(){return(0,g.mG)(this,void 0,void 0,function*(){this.authService.currentUser.balance>0?this.authService.withdrawBalance(this.authService.currentUser.id).subscribe(t=>{t.status?this.payConfirm=!0:t.status||"No enough balance"!=t.error?!t.status&&"No enough balance"==t.error&&this.authService.alert("\u041e\u0448\u0438\u0431\u043a\u0430",t.error.toString()):this.authService.alert("\u041e\u0448\u0438\u0431\u043a\u0430","\u0423 \u0432\u0430\u0441 \u043d\u0435\u0442 \u0430\u043a\u0442\u0438\u0432\u043d\u043e\u0433\u043e \u0431\u0430\u043b\u0430\u043d\u0441\u0430")}):yield this.authService.alert("\u041e\u0448\u0438\u0431\u043a\u0430","\u0423 \u0432\u0430\u0441 \u043d\u0435\u0442 \u0430\u043a\u0442\u0438\u0432\u043d\u043e\u0433\u043e \u0431\u0430\u043b\u0430\u043d\u0441\u0430")})}updateDriverBalance(){this.socketService.updateDriverBalance().subscribe(t=>{if(t){const a=JSON.parse(t);this.authService.currentUser.balance=a.balance,this.authService.currentUser.balance_off=a.balance_off,this.authService.currentUser.balance_in_proccess=a.balance_in_proccess}})}checkShowButton(){this.authService.checkService(this.authService.currentUser.id).subscribe(t=>{var a;t.status&&(this.showTgButton=(null===(a=t.data)||void 0===a?void 0:a.length)>0)})}goToSupportAdmin(){this.iab.create("https://t.me/TIRGO_STOL_USLUG","_system")}doRefresh(t){setTimeout(()=>{t.target.complete(),this.getHistory(),this.getPrice()},1e3)}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(m.i),e.Y36(s.SH),e.Y36(b.$),e.Y36(S.$),e.Y36(o.gz),e.Y36(o.F0),e.Y36(e.sBO))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-balance"]],decls:15,vars:5,consts:[[1,"wrapper-fluid-header"],[1,"logo-wrap","personal-head"],[1,"top-back",3,"click"],["src","assets/img/arrow-left.svg","alt",""],[1,"ion-no-padding","ion-no-margin"],["slot","fixed","pullFactor","1","pullMin","100","pullMax","200",3,"ionRefresh"],["pullingIcon","arrow-dropdown","refreshingSpinner","circles",1,"loadingspinner"],[1,"wrapper-fluid"],["class","body-wrap",4,"ngIf"],[4,"ngIf"],[1,"body-wrap"],[1,"cart-wrap"],["src","assets/img/logo.png","alt",""],[1,"cart-wrap-balance",2,"font-weight","bold"],[1,"payment-method"],[1,"payment-method-wrap"],[3,"ngClass","click"],["src","assets/payment/click.svg","alt",""],["src","assets/payment/payme.svg","alt",""],[2,"width","100%"],[2,"text-align","center","width","100%"],[1,"body-wrap","form-block",2,"width","100%","padding-left","0 !important","padding-right","0 !important"],["class","price-card",3,"active","click",4,"ngFor","ngForOf"],[1,"payment-total","form-block",2,"margin-bottom","10px"],[1,"reg-btn","podpis-buy",2,"background-color","rgba(255, 113, 0, 1)",3,"disabled","click"],["class","reg-btn podpis-buy","style","background-color: #00ABF1FF;margin: 30px 0;display: flex;align-items: center;justify-content: center;gap:10px",3,"click",4,"ngIf"],["style","width: 100%; margin-top: 20px;",4,"ngIf"],[1,"price-card",3,"click"],[1,"month-text"],[1,"price-text",2,"font-weight","bold"],[1,"reg-btn","podpis-buy",2,"background-color","#00ABF1FF","margin","30px 0","display","flex","align-items","center","justify-content","center","gap","10px",3,"click"],["src","assets/img/tg.svg","alt",""],[2,"width","100%","margin-top","20px"],[2,"width","100%","overflow-y","auto","max-height","300px","padding-top","15px","padding-bottom","5px"],["class","price-card","style","display: block !important;margin: 5px 0;",4,"ngFor","ngForOf"],[1,"price-card",2,"display","block !important","margin","5px 0"],[2,"width","100%","color","white","display","flex","gap","10px"],[2,"text-align","center"],["routerLink","/tabs",2,"display","flex"]],template:function(t,a){1&t&&(e.TgZ(0,"ion-header")(1,"div",0)(2,"div",1)(3,"button",2),e.NdJ("click",function(){return a.back()}),e._UZ(4,"img",3),e.qZA(),e.TgZ(5,"h2"),e._uU(6),e.ALo(7,"translate"),e.qZA(),e._UZ(8,"div"),e.qZA()()(),e.TgZ(9,"ion-content",4)(10,"ion-refresher",5),e.NdJ("ionRefresh",function(l){return a.doRefresh(l)}),e._UZ(11,"ion-refresher-content",6),e.qZA(),e.TgZ(12,"div",7),e.YNc(13,P,28,20,"div",8),e.qZA()(),e.YNc(14,k,6,0,"ion-card",9)),2&t&&(e.xp6(6),e.Oqu(e.lcZ(7,3,"\u0423\u0441\u043b\u0443\u0433\u0438 Tirgo Service")),e.xp6(7),e.Q6J("ngIf",a.authService.currentUser),e.xp6(1),e.Q6J("ngIf",a.payConfirm))},dependencies:[n.mk,n.sg,n.O5,s.YG,s.PM,s.Zi,s.Dq,s.W2,s.Gu,s.nJ,s.Wo,s.YI,o.rH,n.uU,h.X$,Z.p],styles:[".price-card[_ngcontent-%COMP%]{display:flex;align-items:center;border:2px solid #ccc;border-radius:10px;padding:10px;width:100%;gap:20px;margin:5px 0}.radio[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;height:30px;width:30px;background-color:#ccc;border-radius:50%}.radio[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{width:15px;height:15px;border-radius:50%;background-color:#ff7100}.price-card.active[_ngcontent-%COMP%]{border:3px solid rgb(255,113,0)}"]}),i})()}];let w=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[o.Bz.forChild(C),o.Bz]}),i})();var q=r(1456);let F=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[n.ez,f.u5,s.Pc,w,_.HeaderPageModule,h.aw,q.h]}),i})()}}]);